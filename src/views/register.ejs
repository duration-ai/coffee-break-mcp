<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token - Coffee Break MCP</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="page">
    <main class="stack">
      <h1 class="title">Token</h1>
      <p class="subtitle">Optional. Enables stats.</p>

      <% if (error) { %>
        <div class="alert"><%= error %></div>
      <% } %>

      <% if (token) { %>
        <div class="card">
          <p class="muted">This is shown once. Stored in a cookie.</p>
          <code class="token" id="token-value"><%= token %></code>
        </div>
        <div class="row">
          <button class="button" type="button" data-copy="token-value">Copy</button>
          <a class="button" href="/stats">View stats</a>
        </div>
      <% } else { %>
        <form class="form" method="POST" action="/auth/register">
          <button class="button" type="submit">Generate token</button>
        </form>
        <a class="muted" href="/">Back</a>
      <% } %>
    </main>
  </div>

  <script>
    document.querySelectorAll('[data-copy]').forEach((button) => {
      button.addEventListener('click', async () => {
        const targetId = button.getAttribute('data-copy');
        const target = targetId ? document.getElementById(targetId) : null;
        if (!target) {
          return;
        }
        const text = target.textContent || '';
        try {
          await navigator.clipboard.writeText(text.trim());
          button.textContent = 'Copied';
          setTimeout(() => {
            button.textContent = 'Copy';
          }, 1500);
        } catch {
          button.textContent = 'Copy failed';
        }
      });
    });
  </script>
</body>
</html>
