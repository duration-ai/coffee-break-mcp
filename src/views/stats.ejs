<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stats - Coffee Break MCP</title>
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="page">
    <main class="stack">
      <h1 class="title">Stats</h1>
      <p class="subtitle">Your break history.</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number"><%= stats.totalBreaks %></div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
          <div class="stat-number"><%= stats.breaksThisWeek %></div>
          <div class="stat-label">This week</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">
            <% if (stats.averageDurationMs) { %>
              <%= Math.round(stats.averageDurationMs / 1000) %>s
            <% } else { %>
              --
            <% } %>
          </div>
          <div class="stat-label">Avg</div>
        </div>
      </div>

      <div class="card">
        <% if (stats.lastTenBreaks.length === 0) { %>
          <p class="muted">No breaks yet.</p>
        <% } else { %>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Started</th>
                  <th>Status</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
                <% stats.lastTenBreaks.forEach(function(b) { %>
                  <tr>
                    <td><%= new Date(b.startedAt).toLocaleString() %></td>
                    <td>
                      <% if (b.isComplete) { %>
                        <span class="badge">Complete</span>
                      <% } else { %>
                        <span class="badge">In progress</span>
                      <% } %>
                    </td>
                    <td>
                      <% if (b.durationMs) { %>
                        <%= Math.round(b.durationMs / 1000) %> s
                      <% } else { %>
                        --
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>

      <div class="card">
        <p class="muted">Use a different token</p>
        <form class="form" method="POST" action="/stats">
          <input
            type="text"
            name="token"
            placeholder="token"
            required
          >
          <button class="button" type="submit">Load stats</button>
        </form>
      </div>

      <div class="card">
        <p class="muted">Token</p>
        <code class="token" id="token-value"><%= token %></code>
        <div class="row" style="margin-top: 12px;">
          <button class="button" type="button" data-copy="token-value">Copy</button>
          <form method="POST" action="/auth/logout">
            <button class="button" type="submit">Sign out</button>
          </form>
        </div>
      </div>

      <a class="muted" href="/">Back</a>
    </main>
  </div>

  <script>
    document.querySelectorAll('[data-copy]').forEach((button) => {
      button.addEventListener('click', async () => {
        const targetId = button.getAttribute('data-copy');
        const target = targetId ? document.getElementById(targetId) : null;
        if (!target) {
          return;
        }
        const text = target.textContent || '';
        try {
          await navigator.clipboard.writeText(text.trim());
          button.textContent = 'Copied';
          setTimeout(() => {
            button.textContent = 'Copy';
          }, 1500);
        } catch {
          button.textContent = 'Copy failed';
        }
      });
    });
  </script>
</body>
</html>
